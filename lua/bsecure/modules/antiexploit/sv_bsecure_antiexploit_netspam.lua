bSecure.AntiExploit.NetSpamCount = {}

local net_Incoming = net.Incoming
function net.Incoming(iLength, pPlayer)

    local sSteamID64 = pPlayer:SteamID64()
    if not bSecure.AntiExploit.NetSpamCount[sSteamID64] then
        bSecure.AntiExploit.NetSpamCount[sSteamID64] = {
            0,
            0,
            CurTime()
        }
    else
        if CurTime() - bSecure.AntiExploit.NetSpamCount[sSteamID64][3] > 1 then
            bSecure.AntiExploit.NetSpamCount[sSteamID64][1] = 0
            bSecure.AntiExploit.NetSpamCount[sSteamID64][2] = 0
            bSecure.AntiExploit.NetSpamCount[sSteamID64][3] = CurTime()
        end

        bSecure.AntiExploit.NetSpamCount[sSteamID64][1] = bSecure.AntiExploit.NetSpamCount[sSteamID64][1] + 1
        bSecure.AntiExploit.NetSpamCount[sSteamID64][2] = bSecure.AntiExploit.NetSpamCount[sSteamID64][2] + (iLength-16)
    end

    if bSecure.AntiExploit.NetSpamCount[sSteamID64][1] > 50 then
        bSecure.PrintDetection("Detected "..bSecure.FormatPlayer(pPlayer).." spamming net messages. Total length - "..bSecure.AntiExploit.NetSpamCount[sSteamID64][2]..". Total of "..bSecure.AntiExploit.NetSpamCount[sSteamID64][1].." messages in "..(CurTime()-bSecure.AntiExploit.NetSpamCount[sSteamID64][3]).."seconds.")
        bSecure.CreateDataLog{Player = pPlayer, Code = "106B", Details = "Detected the player spamming net messages.\nTotal messages sent - "..bSecure.AntiExploit.NetSpamCount[sSteamID64][1].."\nTotal size - "..bSecure.AntiExploit.NetSpamCount[sSteamID64][2].."\nTime Taken - "..(CurTime()-bSecure.AntiExploit.NetSpamCount[sSteamID64][3]).."seconds"}
        bSecure.KickPlayer(pPlayer, "[bSecure] Net message spam. Total length ["..bSecure.AntiExploit.NetSpamCount[sSteamID64][2].."]")
    end

    return net_Incoming(iLength, pPlayer)
end